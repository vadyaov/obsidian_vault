Наследуемся от ScalarMetric, убираем все лишнее. Добавляем шаблонный параметр: какой нибуль Callback. этот callback и будет типом value_ в приватном поле. Далее просто в конструкторе ServicePool вызываем регистрацию метрики(той которая унаследована от ScalarMetric), удаляем поле idle_threads_ из хэдера (оно больше не нужно). Не забываем переопределить метод GetValue() у новой метрики, так что getvalue вызывает callback(). А в сам шаблонный параметр будет пихать service_queue_->estimate_workers_count().

И все. Магия!